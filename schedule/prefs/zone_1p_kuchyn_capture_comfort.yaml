# =====================================================================
# ğŸ§² 1. patro â€“ KuchyÅˆ: zachytÃ¡vÃ¡nÃ­ poslednÃ­ KOMFORTNÃ teploty
# ---------------------------------------------------------------------
# ğŸ” CÃ­l:
# Tato automatizace sleduje, kdy Michal ruÄnÄ› (nebo pÅ™es rozvrh)
# zmÄ›nÃ­ teplotu na hlavici. Pokud novÃ¡ hodnota odpovÃ­dÃ¡ komfortnÃ­mu
# reÅ¾imu (tj. je vyÅ¡Å¡Ã­ neÅ¾ ECO teplota), uloÅ¾Ã­ se do helperu
# `input_number.prizemi_michal_last_comfort`.
#
# â• DÃ­ky tomu se pÅ™i nÃ¡vratu z ECO mÃ³du (napÅ™. po odchodu nebo v noci)
# mÅ¯Å¾e automaticky obnovit prÃ¡vÄ› ta poslednÃ­ komfortnÃ­ teplota,
# kterou uÅ¾ivatel naposledy pouÅ¾il.
# =====================================================================

automation:
  - alias: "Zachytni poslednÃ­ komfort â€“ 1. patro KuchyÅˆ"
    id: capture_last_comfort_1p_kuchyn
    mode: restart
    initial_state: true

    # ğŸ”” SpouÅ¡tÄ›Ä:
    # Sleduje zmÄ›ny atributu `temperature` na hlavici Danfoss.
    # Jakmile uÅ¾ivatel (nebo automatizace) zmÄ›nÃ­ Å¾Ã¡danou teplotu,
    # automatizace se spustÃ­.
    trigger:
      - platform: state
        entity_id: climate.1_patro_kuchyn
        attribute: temperature

    # ğŸ“¦ PromÄ›nnÃ©:
    # `new_set` â†’ novÃ¡ Å¾Ã¡danÃ¡ teplota na hlavici.
    # `eco` â†’ hodnota ECO teploty z globÃ¡lnÃ­ho helperu (typicky 18 Â°C).
    variables:
      new_set: "{{ state_attr('climate.1_patro_kuchyn', 'temperature') | float(0) }}"
      eco: "{{ states('input_number.eco_temp_default') | float(18) }}"

    # âœ… PodmÃ­nka:
    # UloÅ¾Ã­ se jen teplota, kterÃ¡ je o nÄ›co vyÅ¡Å¡Ã­ neÅ¾ ECO (napÅ™. > 18.2 Â°C),
    # aby se neuklÃ¡daly hodnoty z ECO reÅ¾imu nebo drobnÃ© pÅ™echody.
    condition:
      - condition: template
        value_template: "{{ new_set >= (eco + 0.2) }}"

    # ğŸ’¾ Akce:
    # Zapisuje zachycenou komfortnÃ­ teplotu do helperu
    # `input_number.prizemi_michal_last_comfort`.
    # Tato hodnota se pak mÅ¯Å¾e pouÅ¾Ã­t pÅ™i nÃ¡vratu z ECO.
    action:
      - service: input_number.set_value
        target:
          entity_id: input_number.1p_kuchyn_last_comfort
        data:
          value: "{{ new_set }}"
