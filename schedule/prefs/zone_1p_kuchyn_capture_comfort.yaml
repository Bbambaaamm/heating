# =====================================================================
# ğŸ§² 1. patro â€“ KuchyÅˆ: zachytÃ¡vÃ¡nÃ­ poslednÃ­ KOMFORTNÃ teploty
# - Sleduje zmÄ›ny setpointu (attribute: temperature) na hlavici v kuchyni.
# - Pokud novÃ¡ teplota > ECO (s malou hysterezÃ­), uloÅ¾Ã­ ji do 1p_kuchyn_last_comfort.
# - DÃ­ky tomu se po skonÄenÃ­ ECO vÅ¾dy vrÃ¡tÃ­ opravdu poslednÃ­ â€komfortâ€œ.
# =====================================================================

automation:
  - alias: "Zachytni poslednÃ­ komfort â€“ 1. patro KuchyÅˆ"
    id: capture_last_comfort_1p_kuchyn
    mode: restart
    initial_state: true

    # ğŸ”” SpouÅ¡tÄ›Ä: zmÄ›na Å¾Ã¡danÃ© teploty na hlavici (kuchyÅˆ)
    trigger:
      - platform: state
        entity_id: climate.1_patro_kuchyn
        attribute: temperature

    # ğŸ“¦ PromÄ›nnÃ© pro pÅ™ehlednost
    variables:
      new_set: "{{ state_attr('climate.1_patro_kuchyn', 'temperature') | float(0) }}"
      eco: "{{ states('input_number.eco_temp_default') | float(18) }}"

    # âœ… UklÃ¡dÃ¡me jen KOMFORT (tj. > ECO + 0.2 Â°C hystereze)
    condition:
      - condition: template
        value_template: "{{ new_set >= (eco + 0.2) }}"

    # ğŸ’¾ ZapiÅ¡ poslednÃ­ komfortnÃ­ teplotu do helperu
    action:
      - service: input_number.set_value
        target:
          entity_id: input_number.1p_kuchyn_last_comfort
        data:
          value: "{{ new_set }}"
