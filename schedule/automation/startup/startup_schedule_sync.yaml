# YAML 2024.10
# =====================================================================
# Soubor   : config/heating/schedule/automation/startup/startup_schedule_sync.yaml
# Modul    : Startup Schedule Sync
# √öƒçel     : Po startu Home Assistanta p≈ôepoƒç√≠t√° rozvrhy v≈°ech z√≥n
# Autor    : Michal
# Posledn√≠ √∫prava : 2025-11-20
# =====================================================================
# üìå Popis:
# - po startu HA jednor√°zovƒõ spust√≠ smart rozvrhy v≈°ech z√≥n
# - t√≠m se srovn√° stav hlavic (komfort/ECO) s:
#     ‚Ä¢ aktu√°ln√≠m dnem + ƒçasem
#     ‚Ä¢ re≈æimem topen√≠ (Auto / Eco / Boost / Off)
#     ‚Ä¢ posledn√≠m komfortem z√≥n
# - pou≈æ√≠v√° existuj√≠c√≠ automations.*_smart, ≈æ√°dn√° duplicita logiky
# =====================================================================

automation:
  - id: heating_startup_schedule_sync
    alias: "Topen√≠ ‚Äì synchronizace rozvrh≈Ø po startu HA"
    description: >
      Po startu Home Assistanta spust√≠ chytr√© rozvrhy v≈°ech z√≥n, aby
      se komfort/ECO teploty hlavic srovnaly s aktu√°ln√≠m re≈æimem
      topen√≠ a nastaven√Ωm ƒçasov√Ωm oknem.
    mode: restart
    initial_state: true

    trigger:
      - trigger: homeassistant
        event: start

    condition: []

    action:
      # Mal√© zpo≈ædƒõn√≠, aby se po startu naƒçetly v≈°echny helpery/automations
      - delay: "00:00:10"

      # Spus≈• smart rozvrh pro v≈°echny z√≥ny (pou≈æ√≠vaj√≠ vlastn√≠ logiku in_window + m√≥d)
      - action: automation.trigger
        target:
          entity_id:
            - automation.schedule_1p_jidelna_smart
            - automation.schedule_2p_mama_smart
            - automation.schedule_prizemi_michal_smart

      # Z√°znam do logbooku ‚Äì pro p≈ôehled po restartu
      - action: logbook.log
        data:
          name: "Topen√≠ ‚Äì rozvrhy"
          message: "Po startu HA spu≈°tƒõna synchronizace rozvrh≈Ø (smart z√≥ny)."
          entity_id: input_select.topny_rezim
