# =====================================================================
# ğŸ§© ZÃ“NA: 1. patro â€“ KuchyÅˆ
# ---------------------------------------------------------------------
# ğŸ¯ CÃ­l:
# - Definuje logiku zÃ³ny â€1. patro â€“ KuchyÅˆâ€œ
# - Sestavuje senzory pro:
#     â€¢ PoÅ¾adavek na topenÃ­ (%)
#     â€¢ Detekci otevÅ™enÃ©ho okna
#     â€¢ Stav â€zÃ³na aktivnÃ­â€œ (topÃ­)
#
# ğŸ’¡ VÃ½stupy:
# - sensor.zona_1p_jidelna_demand â†’ procento topnÃ©ho vÃ½konu hlavice
# - binary_sensor.zona_1p_jidelna_okno_otevrene â†’ true, pokud je okno otevÅ™enÃ©
# - binary_sensor.zona_1p_jidelna_aktivni â†’ true, pokud zÃ³na skuteÄnÄ› topÃ­
# =====================================================================

template:
  # -------------------------------------------------------------------
  # ğŸ”¸ Å ABLONA: Senzor â€“ PoÅ¾adavek na topenÃ­
  # -------------------------------------------------------------------
  - sensor:
      - name: "zona_1p_jidelna_demand"                          # NÃ¡zev senzoru
        unit_of_measurement: "%"                                # Jednotka mÄ›Å™enÃ­ â€“ procenta
        state_class: measurement                                # Typ mÄ›Å™enÃ­ (kvÅ¯li historii/statistice)
        state: "{{ state_attr('climate.1p_jidelna', 'pi_heating_demand') | int(0) }}"  
        # ÄŒte atribut 'pi_heating_demand' z hlavice climate.1p_jidelna (Danfoss TRV)
        # a pÅ™evede ho na celÃ© ÄÃ­slo; pokud nenÃ­ k dispozici, vrÃ¡tÃ­ 0.

  # -------------------------------------------------------------------
  # ğŸ”¸ Å ABLONA: BinÃ¡rnÃ­ senzory â€“ Okno + Aktivita topenÃ­
  # -------------------------------------------------------------------
  - binary_sensor:
      - name: "zona_1p_jidelna_okno_otevrene"                   # Detekce otevÅ™enÃ©ho okna
        device_class: opening                                   # Typ zaÅ™Ã­zenÃ­ (ikona a chovÃ¡nÃ­ v UI)
        state: >
          {% set s = states('sensor.1p_jidelna_detekovano_otevrene_okno') %}
          {{ s is not string or s|lower != 'closed' }}
        # Pokud senzor okna nehlÃ¡sÃ­ "closed" â†’ povaÅ¾uje se za otevÅ™enÃ©.
        # TÃ­m se zajistÃ­ robustnÃ­ detekce i pÅ™i ztrÃ¡tÄ› signÃ¡lu nebo neznÃ¡mÃ©m stavu.

      - name: "zona_1p_jidelna_aktivni"                         # ZÃ³na aktivnÃ­ (topenÃ­ zapnuto)
        state: >
          {{ (states('sensor.zona_1p_jidelna_demand')|int(0) > 0)
             and (not is_state('binary_sensor.zona_1p_jidelna_okno_otevrene','on')) }}
        # ZÃ³na je aktivnÃ­, pokud:
        #  - hlavice skuteÄnÄ› topÃ­ (demand > 0 %)
        #  - a zÃ¡roveÅˆ nenÃ­ otevÅ™enÃ© okno (blokace topenÃ­ pÅ™i otevÅ™enÃ©m oknÄ›)
