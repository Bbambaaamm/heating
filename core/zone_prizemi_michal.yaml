# YAML 2024.10
# =====================================================================
# ðŸ§  SOUBOR: /config/heating/core/zone_prizemi_michal.yaml
# =========================================
# ðŸ§© ZÃ“NA: PÅ™Ã­zemÃ­ â€“ Michal
# ---------------------------------------------------------------------
# ðŸŽ¯ CÃ­l:
# - Definuje logiku zÃ³ny â€žPÅ™Ã­zemÃ­ - Michalâ€œ
# - Sestavuje senzory pro:
#     â€¢ PoÅ¾adavek na topenÃ­ (%)
#     â€¢ Detekci otevÅ™enÃ©ho okna
#     â€¢ Stav â€žzÃ³na aktivnÃ­â€œ (topÃ­)
#
# ðŸ’¡ VÃ½stupy:
# - sensor.zona_prizemi_michal_demand â†’ procento topnÃ©ho vÃ½konu hlavice
# - binary_sensor.zona_prizemi_michal_okno_otevrene â†’ true, pokud je okno otevÅ™enÃ©
# - binary_sensor.zona_prizemi_michal_aktivni â†’ true, pokud zÃ³na skuteÄnÄ› topÃ­
# =====================================================================

template:
  # ---- Senzory (poÅ¾adavek) ---------------------------------------------------
  - sensor:
      - name: "zona_prizemi_michal_demand" # 0â€“100 % poÅ¾adavku
        unit_of_measurement: "%"
        state_class: measurement
        state: "{{ state_attr('climate.prizemi_michal', 'pi_heating_demand') | int(0) }}"

  # ---- BinÃ¡rnÃ­ senzory (okno + aktivita) ------------------------------------
  - binary_sensor:
      - name: "zona_prizemi_michal_okno_otevrene" # on = okno otevÅ™enÃ©
        device_class: opening
        state: >
          {% set s = states('sensor.prizemi_michal_detekovano_otevrene_okno') %}
          {{ s is not string or s|lower != 'closed' }}

      - name: "zona_prizemi_michal_aktivni" # on = reÃ¡lnÃ¡ poptÃ¡vka zÃ³ny
        state: >
          {{ (states('sensor.zona_prizemi_michal_demand')|int(0) > 1)
             and (not is_state('binary_sensor.zona_prizemi_michal_okno_otevrene','on')) }}
