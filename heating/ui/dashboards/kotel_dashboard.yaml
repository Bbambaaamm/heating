# =====================================================================
# Soubor   : config/heating/ui/dashboards/kotel_dashboard.yaml
# Modul    : UI ‚Äì Dashboard KOTEL (chov√°n√≠ + n√°klady)
# √öƒçel     : Rychl√° diagnostika chov√°n√≠ kotle + sledov√°n√≠ spot≈ôeby
# Autor    : Michal
# Posledn√≠ √∫prava : 2025-12-13
# =====================================================================
# üìå Obsah:
# - Stav kotle: po≈æadavek vs. realita (kotel_should_be_on vs burngas)
# - Demand agregace: aktivn√≠ z√≥ny + pr≈Ømƒõr + max
# - EMS-ESP kotel: v√Ωkon ho≈ô√°ku, v√Ωstupn√≠ teplota, pumpa, provozn√≠ ƒçasy
# - Spot≈ôeba: utility_meter denn√≠/mƒõs√≠ƒçn√≠ plyn + energie
# =====================================================================

title: Kotel
path: kotel
icon: mdi:fire
theme: default
views:
  - title: P≈ôehled
    path: overview
    icon: mdi:view-dashboard
    cards:

      # ===============================================================
      # SEKCE: Rychl√Ω stav
      # ===============================================================
      - type: grid
        title: Rychl√Ω stav
        columns: 3
        square: false
        cards:
          - type: entity
            name: Po≈æadavek na kotel
            entity: binary_sensor.kotel_should_be_on

          - type: entity
            name: Ho≈ô√°k (plyn)
            entity: binary_sensor.boiler_burngas

          - type: entity
            name: ƒåerpadlo topen√≠
            entity: binary_sensor.boiler_heatingpump


      # ===============================================================
      # SEKCE: Po≈æadavek vs. realita (ƒçasov√© grafy)
      # ===============================================================
      - type: history-graph
        title: Po≈æadavek vs. ho≈ô√°k (posledn√≠ch 24h)
        hours_to_show: 24
        refresh_interval: 30
        entities:
          - entity: binary_sensor.kotel_should_be_on
            name: should_be_on
          - entity: binary_sensor.boiler_burngas
            name: burngas
          - entity: binary_sensor.boiler_heatingpump
            name: pump


      # ===============================================================
      # SEKCE: Demand a z√≥ny
      # ===============================================================
      - type: grid
        title: Demand agregace
        columns: 3
        square: false
        cards:
          - type: gauge
            name: Aktivn√≠ z√≥ny (poƒçet)
            entity: sensor.kotel_aktivni_zony_pocet
            min: 0
            max: 8

          - type: gauge
            name: Pr≈Ømƒõr demand (%)
            entity: sensor.kotel_poptavka_prumer
            min: 0
            max: 100

          - type: gauge
            name: Max demand (%)
            entity: sensor.kotel_poptavka_max
            min: 0
            max: 100

      - type: history-graph
        title: Demand trendy (posledn√≠ch 24h)
        hours_to_show: 24
        refresh_interval: 30
        entities:
          - entity: sensor.kotel_aktivni_zony_pocet
            name: aktivn√≠ z√≥ny
          - entity: sensor.kotel_poptavka_prumer
            name: pr≈Ømƒõr demand
          - entity: sensor.kotel_poptavka_max
            name: max demand


      # ===============================================================
      # SEKCE: EMS-ESP ‚Äì v√Ωkon a teploty
      # ===============================================================
      - type: history-graph
        title: Ho≈ô√°k ‚Äì v√Ωkon + v√Ωstupn√≠ teplota (posledn√≠ch 24h)
        hours_to_show: 24
        refresh_interval: 30
        entities:
          - entity: sensor.boiler_curburnpow
            name: v√Ωkon ho≈ô√°ku (%)
          - entity: sensor.boiler_curflowtemp
            name: v√Ωstupn√≠ teplota (¬∞C)
          - entity: sensor.boiler_heatingpumpmod
            name: modulace pumpy (%)

      - type: entities
        title: EMS-ESP rychl√© hodnoty
        show_header_toggle: false
        entities:
          - entity: sensor.boiler_curflowtemp
            name: Namƒõ≈ôen√° v√Ωstupn√≠ teplota
          - entity: sensor.boiler_headertemp
            name: Low loss header
          - entity: sensor.boiler_curburnpow
            name: Aktu√°ln√≠ v√Ωkon ho≈ô√°ku
          - entity: sensor.boiler_absburnpow
            name: Aktu√°ln√≠ v√Ωkon ho≈ô√°ku (absolutn√≠)
          - entity: sensor.boiler_flamecurr
            name: Proud plamene
          - entity: sensor.boiler_servicecodenumber
            name: Servisn√≠ k√≥d (ƒç√≠slo)
          - entity: sensor.boiler_lastcode
            name: Posledn√≠ k√≥d chyby


      # ===============================================================
      # SEKCE: Spot≈ôeba (utility_meter)
      # ===============================================================
      - type: grid
        title: Spot≈ôeba (utility meters)
        columns: 2
        square: false
        cards:
          - type: entities
            title: Plyn (vyt√°pƒõn√≠)
            show_header_toggle: false
            entities:
              - entity: sensor.heating_gas_daily
                name: Denn√≠ plyn ‚Äì topen√≠
              - entity: sensor.heating_gas_monthly
                name: Mƒõs√≠ƒçn√≠ plyn ‚Äì topen√≠
              - entity: sensor.boiler_gasmeterheat
                name: Celkov√© poƒç√≠tadlo ‚Äì topen√≠

          - type: entities
            title: Energie (vyt√°pƒõn√≠)
            show_header_toggle: false
            entities:
              - entity: sensor.heating_energy_daily
                name: Denn√≠ energie ‚Äì topen√≠
              - entity: sensor.heating_energy_monthly
                name: Mƒõs√≠ƒçn√≠ energie ‚Äì topen√≠
              - entity: sensor.boiler_nrgheat
                name: Celkov√° energie ‚Äì topen√≠

      - type: history-graph
        title: Spot≈ôeba ‚Äì trendy (posledn√≠ch 7 dn√≠)
        hours_to_show: 168
        refresh_interval: 300
        entities:
          - entity: sensor.heating_gas_daily
            name: plyn dennƒõ
          - entity: sensor.heating_energy_daily
            name: energie dennƒõ
          - entity: sensor.total_energy_daily
            name: celkem energie dennƒõ


      # ===============================================================
      # SEKCE: Re≈æim a ovl√°d√°n√≠ (kontext)
      # ===============================================================
      - type: entities
        title: Re≈æimy a ≈ô√≠zen√≠ (kontext)
        show_header_toggle: false
        entities:
          - entity: input_select.topny_rezim
            name: Re≈æim
          - entity: input_boolean.topny_system_enable
            name: Syst√©m povolen
          - entity: binary_sensor.kotel_boost_active
            name: Boost active
          - entity: input_boolean.boost_now
            name: Boost ‚Äì zapnout nyn√≠
          - entity: input_datetime.boost_until
            name: Boost ‚Äì plat√≠ do
          - entity: input_number.kotel_min_avg_demand_pct
            name: Min pr≈Ømƒõr demand (%)
          - entity: input_number.kotel_min_active_zones
            name: Min aktivn√≠ch z√≥n
          - entity: input_number.kotel_on_delay_sec
            name: ON delay (s)
          - entity: input_number.kotel_off_delay_sec
            name: OFF delay (s)
