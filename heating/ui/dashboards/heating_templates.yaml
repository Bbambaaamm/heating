# =====================================================================
# Soubor   : config/heating/ui/dashboards/heating_templates.yaml
# Modul    : UI ‚Äì Dashboard senzory (aktu√°ln√≠ teploty z√≥n)
# √öƒçel     : Poskytnout UI-friendly senzory pro vizualizaci na dashboardu
# Autor    : Michal
# Posledn√≠ √∫prava : 2025-11-19
# =====================================================================
# üìå Obsah:
#   - Senzory s aktu√°ln√≠ teplotou ve v≈°ech z√≥n√°ch
#   - V≈°echny hodnoty bezpeƒçnƒõ o≈°et≈ôen√© (float/attr fallback)
#
# üìù Pozn√°mky:
# - climate.* ‚Üí current_temperature pou≈æ√≠v√°me tam, kde je dostupn√Ω
# - U z√≥ny 1P J√≠delna je pou≈æit Zigbee extern√≠ senzor (tz3000‚Ä¶)
# - V≈°echny v√Ωstupy maj√≠ jednotku ¬∞C
# =====================================================================


template:
  - sensor:

      # -----------------------------------------------------------------
      # üè† Sklep ‚Äì Michal: aktu√°ln√≠ teplota z hlavice z extern√≠ho senzoru xiaomi
      # -----------------------------------------------------------------
      - name: "Sklep Michal ‚Äì aktu√°ln√≠ teplota"
        unit_of_measurement: "¬∞C"
        device_class: temperature
        state_class: measurement
        availability: >
          {{ not is_state('climate.sklep_michal', 'unavailable') }}
        state: >
          {{ state_attr('climate.sklep_michal', 'current_temperature') | float(0) }}

      # -----------------------------------------------------------------
      # üè† P≈ô√≠zem√≠ ‚Äì Michal: aktu√°ln√≠ teplota z hlavice
      # -----------------------------------------------------------------
      - name: "P≈ô√≠zem√≠ Michal ‚Äì aktu√°ln√≠ teplota"
        unit_of_measurement: "¬∞C"
        device_class: temperature
        state_class: measurement
        availability: >
          {{ not is_state('climate.prizemi_michal', 'unavailable') }}
        state: >
          {{ state_attr('climate.prizemi_michal', 'current_temperature') | float(0) }}

      # -----------------------------------------------------------------
      # üè† P≈ô√≠zem√≠ ‚Äì Chodba z√°chod: aktu√°ln√≠ teplota z hlavice
      # -----------------------------------------------------------------
      - name: "P≈ô√≠zem√≠ Chodba z√°chod ‚Äì aktu√°ln√≠ teplota"
        unit_of_measurement: "¬∞C"
        device_class: temperature
        state_class: measurement
        availability: >
          {{ not is_state('climate.prizemi_chodba_zachod', 'unavailable') }}
        state: >
          {{ state_attr('climate.prizemi_chodba_zachod', 'current_temperature') | float(0) }}

      # -----------------------------------------------------------------
      # üè† 1. patro ‚Äì Kuchy≈à: aktu√°ln√≠ teplota z hlavice
      # -----------------------------------------------------------------
      - name: "1. patro - Kuchy≈à ‚Äì aktu√°ln√≠ teplota"
        unit_of_measurement: "¬∞C"
        device_class: temperature
        state_class: measurement
        availability: >
          {{ not is_state('climate.1p_kuchyn', 'unavailable') }}
        state: >
          {{ state_attr('climate.1p_kuchyn', 'current_temperature') | float(0) }}

      # -----------------------------------------------------------------
      # ü•ò 1. patro ‚Äì J√≠delna: aktu√°ln√≠ teplota z extern√≠ho Zigbee senzoru
      # -----------------------------------------------------------------
      - name: "1. patro J√≠delna ‚Äì aktu√°ln√≠ teplota"
        unit_of_measurement: "¬∞C"
        device_class: temperature
        state_class: measurement
        availability: >
          {{ not is_state('sensor.tz3000_jidelna_teplota', 'unavailable') }}
        state: >
          {{ states('sensor.tz3000_jidelna_teplota') | float(0) | round(1) }}

      # -----------------------------------------------------------------
      # ü•ò 1. patro ‚Äì Chodba: aktu√°ln√≠ teplota z hlavice
      # -----------------------------------------------------------------
      - name: "1. patro Chodba ‚Äì aktu√°ln√≠ teplota"
        unit_of_measurement: "¬∞C"
        device_class: temperature
        state_class: measurement
        availability: >
          {{ not is_state('climate.1p_chodba', 'unavailable') }}
        state: >
          {{ state_attr('climate.1p_chodba', 'current_temperature') | float(0) }}

      # -----------------------------------------------------------------
      # ü•ò 1. patro ‚Äì Koupelna: aktu√°ln√≠ teplota z hlavice
      # -----------------------------------------------------------------
      - name: "1. patro Koupelna ‚Äì aktu√°ln√≠ teplota"
        unit_of_measurement: "¬∞C"
        device_class: temperature
        state_class: measurement
        availability: >
          {{ not is_state('climate.1p_koupelna', 'unavailable') }}
        state: >
          {{ state_attr('climate.1p_koupelna', 'current_temperature') | float(0) }}

      # -----------------------------------------------------------------
      # üë© 2. patro ‚Äì M√°ma: aktu√°ln√≠ teplota z hlavice
      # -----------------------------------------------------------------
      - name: "2. patro M√°ma ‚Äì aktu√°ln√≠ teplota"
        unit_of_measurement: "¬∞C"
        device_class: temperature
        state_class: measurement
        availability: >
          {{ not is_state('climate.2p_mama', 'unavailable') }}
        state: >
          {{ state_attr('climate.2p_mama', 'current_temperature') | float(0) }}

      # -----------------------------------------------------------------
      # üö® BOOST ‚Äì poƒçet z√≥n blokuj√≠c√≠ch Boost (MANU√ÅL / override lock)
      # - poƒç√≠t√° z√≥ny z group.topne_zony, kter√© maj√≠ input_boolean.<zone>_manual_override = on
      # - aktivn√≠ jen kdy≈æ je zapnut√Ω Boost (binary_sensor.kotel_boost_active)
      # - atribut blocked_zones obsahuje seznam n√°zv≈Ø (friendly_name) tƒõchto z√≥n
      # -----------------------------------------------------------------
      - name: "BOOST ‚Äì blokovan√© z√≥ny (poƒçet)"
        unique_id: boost_blocked_zones_count
        icon: mdi:alert-circle
        state: >
          {% set boost_on = is_state('binary_sensor.kotel_boost_active', 'on') %}
          {% if not boost_on %}
            0
          {% else %}
            {% set zones = state_attr('group.topne_zony', 'entity_id') | default([], true) %}
            {% set blocked = namespace(count=0) %}
            {% for z in zones %}
              {% set obj = z.split('.')[1] %}
              {% set helper = 'input_boolean.' ~ obj ~ '_manual_override' %}
              {% if states(helper) == 'on' %}
                {% set blocked.count = blocked.count + 1 %}
              {% endif %}
            {% endfor %}
            {{ blocked.count }}
          {% endif %}
        attributes:
          blocked_zones: >
            {% set boost_on = is_state('binary_sensor.kotel_boost_active', 'on') %}
            {% if not boost_on %}
              []
            {% else %}
              {% set zones = state_attr('group.topne_zony', 'entity_id') | default([], true) %}
              {% set names = namespace(list=[]) %}
              {% for z in zones %}
                {% set obj = z.split('.')[1] %}
                {% set helper = 'input_boolean.' ~ obj ~ '_manual_override' %}
                {% if states(helper) == 'on' %}
                  {% set names.list = names.list + [state_attr(z, 'friendly_name') | default(states[z].name, true)] %}
                {% endif %}
              {% endfor %}
              {{ names.list }}
            {% endif %}

input_boolean:

  ui_sklep_michal_schedule_expand:
    name: UI ‚Äì Sklep Michal rozvrh rozbalit
    icon: mdi:unfold-more-horizontal

  ui_prizemi_michal_schedule_expand:
    name: UI ‚Äì P≈ô√≠zem√≠ Michal rozvrh rozbalit
    icon: mdi:unfold-more-horizontal

  ui_prizemi_chodba_zachod_schedule_expand:
    name: UI ‚Äì P≈ô√≠zem√≠ Chodba z√°chod rozvrh rozbalit
    icon: mdi:unfold-more-horizontal

  ui_1p_chodba_schedule_expand:
    name: UI ‚Äì 1. patro Chodba rozvrh rozbalit
    icon: mdi:unfold-more-horizontal

  ui_1p_jidelna_schedule_expand:
    name: UI ‚Äì 1. patro J√≠delna rozvrh rozbalit
    icon: mdi:unfold-more-horizontal

  ui_1p_kuchyn_schedule_expand:
    name: UI ‚Äì 1. patro Kuchy≈à rozvrh rozbalit
    icon: mdi:unfold-more-horizontal

  ui_1p_koupelna_schedule_expand:
    name: UI ‚Äì 1. patro Koupelna rozvrh rozbalit
    icon: mdi:unfold-more-horizontal

  ui_2p_mama_schedule_expand:
    name: UI ‚Äì 2. patro M√°ma rozvrh rozbalit
    icon: mdi:unfold-more-horizontal

  ui_global_manual_launcher:
    name: UI ‚Äì Centr√°ln√≠ manu√°l (launcher)
    icon: mdi:tune-variant
