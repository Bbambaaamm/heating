cover:
  - platform: template
    covers:
      vrata_ui:
        friendly_name: "Vrata"
        device_class: gate

        # Stav – překlopí opening -> closed, closing -> open
        value_template: >
          {% set s = states('cover.vrata_gatebox_position') %}
          {% if s == 'opening' %}closed
          {% elif s == 'closing' %}open
          {% else %}{{ s }}
          {% endif %}

        # Pozice – potlačí „50 % při jízdě“
        position_template: >
          {% set s = states('cover.vrata_gatebox_position') %}
          {% if s == 'opening' %}0
          {% elif s == 'closing' %}100
          {% elif state_attr('cover.vrata_gatebox_position','current_position') is number %}
            {{ state_attr('cover.vrata_gatebox_position','current_position') | int }}
          {% else %}0
          {% endif %}

        # Všechna tři tlačítka posílají jeden pulz (toggle) na původní cover
        open_cover:
          - service: cover.open_cover
            target:
              entity_id: cover.vrata_gatebox_position
        close_cover:
          - service: cover.open_cover
            target:
              entity_id: cover.vrata_gatebox_position
        stop_cover:
          - service: cover.open_cover
            target:
              entity_id: cover.vrata_gatebox_position

script:
  vrata_stop:
    alias: Vrata – STOP
    sequence:
      - service: cover.stop_cover
        target:
          entity_id: cover.vrata_ui
