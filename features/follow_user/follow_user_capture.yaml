# =====================================================================
# ðŸ”„ ZachytÃ¡vÃ¡nÃ­ â€žposlednÃ­ uÅ¾ivatelskÃ© teplotyâ€œ ze skuteÄnÃ½ch hlavic
# - Kdykoliv se zmÄ›nÃ­ cÃ­lovÃ¡ teplota (setpoint) na climate.*,
#   zapÃ­Å¡eme ji do pÅ™Ã­sluÅ¡nÃ©ho input_number.*_user_set_temp.
# - PÅ™i startu HA provedeme inicializaci (vezmeme aktuÃ¡lnÃ­ setpoint).
# - DÅ¯raz na robustnost: hlÃ­dÃ¡me â€žunknown/unavailableâ€œ a nuly.
# =====================================================================

automation:

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # â–¶ï¸ PÅ™Ã­zemÃ­ â€“ Michal (climate.danfoss_etrv0103)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: zona_prizemi_michal_capture_setpoint
    alias: "ZÃ³na â€“ PÅ™Ã­zemÃ­ Michal: zachyÅ¥ zmÄ›nu setpointu"
    mode: restart
    trigger:
      # Trigguj pÅ™i jakÃ©koliv zmÄ›nÄ› (vÄetnÄ› atributÅ¯); filtrujeme v akci.
      - platform: state
        entity_id: climate.danfoss_etrv0103
    variables:
      new_sp: "{{ state_attr('climate.danfoss_etrv0103','temperature') | float(0) }}"
    condition:
      - condition: template
        value_template: "{{ new_sp > 0 }}"
    action:
      - service: input_number.set_value
        data:
          entity_id: input_number.zona_prizemi_michal_user_set_temp
          value: "{{ new_sp }}"

  - id: zona_prizemi_michal_init_on_start
    alias: "ZÃ³na â€“ PÅ™Ã­zemÃ­ Michal: init helperu po startu"
    mode: single
    trigger:
      - platform: homeassistant
        event: start
    action:
      # poÄkej chvilku, aÅ¥ se climate stihne naÄÃ­st
      - delay: "00:00:05"
      - variables:
          sp: "{{ state_attr('climate.danfoss_etrv0103','temperature') | float(22.0) }}"
      - service: input_number.set_value
        data:
          entity_id: input_number.zona_prizemi_michal_user_set_temp
          value: "{{ sp }}"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # â–¶ï¸ 1. patro â€“ KuchyÅˆ (climate.1_patro_kuchyn)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: zona_1p_kuchyn_capture_setpoint
    alias: "ZÃ³na â€“ 1. patro KuchyÅˆ: zachyÅ¥ zmÄ›nu setpointu"
    mode: restart
    trigger:
      - platform: state
        entity_id: climate.1_patro_kuchyn
    variables:
      new_sp: "{{ state_attr('climate.1_patro_kuchyn','temperature') | float(0) }}"
    condition:
      - condition: template
        value_template: "{{ new_sp > 0 }}"
    action:
      - service: input_number.set_value
        data:
          entity_id: input_number.zona_1p_kuchyn_user_set_temp
          value: "{{ new_sp }}"

  - id: zona_1p_kuchyn_init_on_start
    alias: "ZÃ³na â€“ 1. patro KuchyÅˆ: init helperu po startu"
    mode: single
    trigger:
      - platform: homeassistant
        event: start
    action:
      - delay: "00:00:05"
      - variables:
          sp: "{{ state_attr('climate.1_patro_kuchyn','temperature') | float(22.0) }}"
      - service: input_number.set_value
        data:
          entity_id: input_number.zona_1p_kuchyn_user_set_temp
          value: "{{ sp }}"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # â–¶ï¸ 2. patro â€“ MÃ¡ma (climate.danfoss_etrv0103_2)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: zona_2p_mama_capture_setpoint
    alias: "ZÃ³na â€“ 2. patro MÃ¡ma: zachyÅ¥ zmÄ›nu setpointu"
    mode: restart
    trigger:
      - platform: state
        entity_id: climate.danfoss_etrv0103_2
    variables:
      new_sp: "{{ state_attr('climate.danfoss_etrv0103_2','temperature') | float(0) }}"
    condition:
      - condition: template
        value_template: "{{ new_sp > 0 }}"
    action:
      - service: input_number.set_value
        data:
          entity_id: input_number.zona_2p_mama_user_set_temp
          value: "{{ new_sp }}"

  - id: zona_2p_mama_init_on_start
    alias: "ZÃ³na â€“ 2. patro MÃ¡ma: init helperu po startu"
    mode: single
    trigger:
      - platform: homeassistant
        event: start
    action:
      - delay: "00:00:05"
      - variables:
          sp: "{{ state_attr('climate.danfoss_etrv0103_2','temperature') | float(22.0) }}"
      - service: input_number.set_value
        data:
          entity_id: input_number.zona_2p_mama_user_set_temp
          value: "{{ sp }}"
