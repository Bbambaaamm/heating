# =====================================================================
# ğŸ§  SOUBOR: /config/heating/control/mode_logic.yaml
# =====================================================================
# ğŸ›ï¸ LOGIKA REÅ½IMÅ® TOPENÃ (Auto / Eco / Boost / Off)
# ---------------------------------------------------------------------
# ğŸ“Œ CÃL:
# Tento modul zajiÅ¡Å¥uje zÃ¡kladnÃ­ logiku pÅ™epÃ­nÃ¡nÃ­ reÅ¾imÅ¯ topenÃ­.
# Reaguje na zmÄ›nu `input_select.topny_rezim` a podle toho:
#   ğŸ”¹ PÅ™i â€Offâ€œ okamÅ¾itÄ› vypne kotel (relÃ© Aqara T2)
#   ğŸ”¹ U ostatnÃ­ch reÅ¾imÅ¯ pouze zaznamenÃ¡ zmÄ›nu do Logbooku
#
# âš™ï¸ FUNKCE:
# - Sleduje zmÄ›ny reÅ¾imu (Auto / Eco / Boost / Off)
# - U reÅ¾imu Off zajistÃ­ okamÅ¾itÃ© vypnutÃ­ kotle
# - Pro vÅ¡echny reÅ¾imy zapisuje pÅ™ehlednÃ© udÃ¡losti do Logbooku
#
# ğŸš« Co tento soubor NEDÄšLÃ:
# - NeÅ™Ã­dÃ­ Å¾Ã¡dnÃ© binary sensory (blokace je v `mode_engine.yaml`)
# - NepoÄÃ­tÃ¡ ÃºÄinnÃ© prahy (`effective_*` â€“ Å™eÅ¡Ã­ `mode_engine.yaml`)
# - NeÅ™eÅ¡Ã­ Boost logiku / ÄasovÃ¡nÃ­ (`boost_now`, `boost_until`)
#
# ğŸ”— NAPOJENÃ:
# - `mode_engine.yaml` â†’ vypoÄÃ­tÃ¡vÃ¡ prahy a blokace
# - `kotel_control.yaml` â†’ pouÅ¾Ã­vÃ¡ tyto prahy pro spÃ­nÃ¡nÃ­ kotle
#
# ğŸ“˜ STANDARD:
# - VÅ¡echny reakce ÄistÄ› na Ãºrovni pÅ™epÃ­naÄe reÅ¾imu
# - Logbook pouÅ¾Ã­vÃ¡n pro auditnÃ­ a diagnostickÃ© ÃºÄely
# =====================================================================

automation:
  - alias: "TopenÃ­ â€“ logika reÅ¾imÅ¯ (ÄistÃ¡)"
    id: heating_mode_logic_clean
    description: "Reaguje na zmÄ›nu reÅ¾imu. Pro Off vypne kotel; ostatnÃ­ reÅ¾imy pouze loguje."
    mode: restart # Restart = vÅ¾dy reaguje na poslednÃ­ zmÄ›nu

    # ğŸ›ï¸ SpouÅ¡tÄ›Ä: zmÄ›na reÅ¾imu topenÃ­
    trigger:
      - platform: state
        entity_id: input_select.topny_rezim

    action:
      - choose:
          # ğŸ”» REÅ½IM OFF â†’ okamÅ¾itÃ© vypnutÃ­ kotle
          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Off"
            sequence:
              - service: switch.turn_off # Vypni relÃ© kotle
                target:
                  entity_id: switch.kotel_rele
              - service: logbook.log # Zaznamenej udÃ¡lost
                data:
                  name: "TopenÃ­ â€“ reÅ¾imy"
                  message: "ReÅ¾im pÅ™epnut na Off â†’ kotel vypnut."
                  entity_id: switch.kotel_rele

          # ğŸ”¸ REÅ½IM AUTO â†’ standardnÃ­ provoz
          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Auto"
            sequence:
              - service: logbook.log
                data:
                  name: "TopenÃ­ â€“ reÅ¾imy"
                  message: "ReÅ¾im Auto â†’ pouÅ¾Ã­vajÃ­ se ÃºÄinnÃ© prahy z mode_engine."
                  entity_id: input_select.topny_rezim

          # ğŸŒ¿ REÅ½IM ECO â†’ ÃºspornÄ›jÅ¡Ã­ reÅ¾im
          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Eco"
            sequence:
              - service: logbook.log
                data:
                  name: "TopenÃ­ â€“ reÅ¾imy"
                  message: "ReÅ¾im Eco â†’ pÅ™Ã­snÄ›jÅ¡Ã­ ÃºÄinnÃ© prahy (mode_engine)."
                  entity_id: input_select.topny_rezim

          # âš¡ REÅ½IM BOOST â†’ krÃ¡tkodobÃ© â€pÅ™itopâ€œ
          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Boost"
            sequence:
              - service: logbook.log
                data:
                  name: "TopenÃ­ â€“ reÅ¾imy"
                  message: "ReÅ¾im Boost â†’ uvolnÄ›nÃ© ÃºÄinnÃ© prahy + ÄasovÃ¡nÃ­ (mode_engine)."
                  entity_id: input_select.topny_rezim
