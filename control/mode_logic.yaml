# =====================================================================
# ğŸ§  SOUBOR: /config/heating/control/mode_logic.yaml
# =====================================================================
# ğŸ›ï¸ Logika pÅ™epÃ­nÃ¡nÃ­ reÅ¾imÅ¯ topenÃ­ (Auto / Eco / Boost / Off)
# -------------------------------------------------------------
# Co TENTO soubor dÄ›lÃ¡:
#  - Sleduje zmÄ›nu input_select.topny_rezim
#  - Pro "Off" okamÅ¾itÄ› vypne relÃ© kotle (Aqara T2)
#  - ZapÃ­Å¡e udÃ¡lost do Logbooku pro pÅ™ehled
#
# Co TENTO soubor NEDÄšLÃ (zÃ¡mÄ›rnÄ›):
#  - NeovlÃ¡dÃ¡ Å¾Ã¡dnÃ½ binary_sensor (nejde to) â€“ blokace Off se dÄ›lÃ¡ v mode_engine.yaml
#  - NepÅ™episuje prahy input_number.kotel_min_* â€“ ÃºÄinnÃ© prahy poÄÃ­tÃ¡ mode_engine.yaml
#  - NeÅ™eÅ¡Ã­ Boost tlaÄÃ­tko / ÄasovÃ¡nÃ­ â€“ to je v mode_engine.yaml (aby nebyly duplicity)
# =====================================================================

automation:
  - alias: "TopenÃ­ â€“ logika reÅ¾imÅ¯ (ÄistÃ¡)"
    id: heating_mode_logic_clean
    description: "Reaguje na zmÄ›nu reÅ¾imu. Pro Off vypne kotel; ostatnÃ­ reÅ¾imy nechÃ¡vÃ¡ na mode_engine."
    mode: restart

    # ğŸ›ï¸ SpouÅ¡tÄ›Ä: kdykoli se zmÄ›nÃ­ zvolenÃ½ reÅ¾im (Auto / Eco / Boost / Off)
    trigger:
      - platform: state
        entity_id: input_select.topny_rezim

    action:
      - choose:

          # ========================================================
          # ğŸ”» REÅ½IM OFF â€“ kompletnÃ­ vypnutÃ­ topenÃ­
          #  - OkamÅ¾itÄ› vypne Aqara T2 relÃ© (kotel)
          #  - Blokace kotle se souÄasnÄ› projevÃ­ i v binary_sensor.kotel_mode_off_block
          #    (ten se vyhodnocuje v mode_engine.yaml z reÅ¾imu a master pÅ™epÃ­naÄe)
          # ========================================================
          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Off"
            sequence:
              - service: switch.turn_off
                target:
                  entity_id: switch.aqara_lumi_switch_acn047_spinac

              - service: logbook.log
                data:
                  name: "TopenÃ­ â€“ reÅ¾imy"
                  message: "ReÅ¾im pÅ™epnut na Off â†’ kotel vypnut."
                  entity_id: switch.aqara_lumi_switch_acn047_spinac

          # ========================================================
          # ğŸ”¸ REÅ½IM AUTO â€“ standardnÃ­ provoz
          #  - Nic aktivnÄ› nenastavujeme: ÃºÄinnÃ© prahy Å™eÅ¡Ã­ mode_engine.yaml
          # ========================================================
          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Auto"
            sequence:
              - service: logbook.log
                data:
                  name: "TopenÃ­ â€“ reÅ¾imy"
                  message: "ReÅ¾im Auto â†’ pouÅ¾Ã­vajÃ­ se ÃºÄinnÃ© prahy z mode_engine."
                  entity_id: input_select.topny_rezim

          # ========================================================
          # ğŸŒ¿ REÅ½IM ECO â€“ ÃºspornÄ›jÅ¡Ã­
          #  - Nic aktivnÄ› nenastavujeme: zpÅ™Ã­snÄ›nÃ­ prahÅ¯ Å™eÅ¡Ã­ mode_engine.yaml
          # ========================================================
          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Eco"
            sequence:
              - service: logbook.log
                data:
                  name: "TopenÃ­ â€“ reÅ¾imy"
                  message: "ReÅ¾im Eco â†’ pÅ™Ã­snÄ›jÅ¡Ã­ ÃºÄinnÃ© prahy (mode_engine)."
                  entity_id: input_select.topny_rezim

          # ========================================================
          # âš¡ REÅ½IM BOOST â€“ krÃ¡tkodobÃ© â€pÅ™itopâ€œ
          #  - Nic aktivnÄ› nenastavujeme: boost_until a auto-ukonÄenÃ­ Å™eÅ¡Ã­ mode_engine.yaml
          # ========================================================
          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Boost"
            sequence:
              - service: logbook.log
                data:
                  name: "TopenÃ­ â€“ reÅ¾imy"
                  message: "ReÅ¾im Boost â†’ uvolnÄ›nÃ© ÃºÄinnÃ© prahy + ÄasovÃ¡nÃ­ (mode_engine)."
                  entity_id: input_select.topny_rezim
