# YAML 2024.10
# =====================================================================
# üß† SOUBOR: /config/heating/control/mode_logic.yaml
# =====================================================================

automation:
  - alias: "Topen√≠ ‚Äì logika re≈æim≈Ø (ƒçist√°)"
    id: heating_mode_logic_clean
    description: "Reaguje na zmƒõnu re≈æimu. Pro Off vypne kotel; ostatn√≠ re≈æimy pouze loguje."
    mode: restart

    triggers:
      - trigger: state
        entity_id: input_select.topny_rezim

    conditions:
      - condition: template
        value_template: "{{ trigger.from_state is not none and trigger.from_state.state != trigger.to_state.state }}"

    actions:
      - choose:
          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Off"
            sequence:
              - action: switch.turn_off
                target:
                  entity_id: switch.kotel_rele_spinac
              - action: logbook.log
                data:
                  name: "Topen√≠ ‚Äì re≈æimy"
                  message: "Re≈æim p≈ôepnut na Off ‚Üí kotel vypnut."
                  entity_id: switch.kotel_rele_spinac

          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Auto"
            sequence:
              - action: logbook.log
                data:
                  name: "Topen√≠ ‚Äì re≈æimy"
                  message: "Re≈æim Auto ‚Üí pou≈æ√≠vaj√≠ se √∫ƒçinn√© prahy (policy/mode_engine)."
                  entity_id: input_select.topny_rezim

          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Eco"
            sequence:
              - action: logbook.log
                data:
                  name: "Topen√≠ ‚Äì re≈æimy"
                  message: "Re≈æim Eco ‚Üí p≈ô√≠snƒõj≈°√≠ √∫ƒçinn√© prahy (policy/mode_engine)."
                  entity_id: input_select.topny_rezim

          - conditions:
              - condition: state
                entity_id: input_select.topny_rezim
                state: "Boost"
            sequence:
              - action: logbook.log
                data:
                  name: "Topen√≠ ‚Äì re≈æimy"
                  message: "Re≈æim Boost ‚Üí uvolnƒõn√© prahy + ƒçasov√°n√≠ (mode_engine)."
                  entity_id: input_select.topny_rezim
