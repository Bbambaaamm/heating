# YAML 2024.10
# =====================================================================
# üß† /config/heating/control/mode_engine.yaml ‚Äì BOOST LOGIKA (only)
# =====================================================================

automation:
  # ‚ñ∂Ô∏è AUTO ON ‚Üí zru≈° Boost a znovu aplikuj rozvrhy
  - id: heating_auto_apply_on
    alias: "Auto: aktivace a n√°vrat k rozvrh≈Øm"
    mode: restart
    triggers:
      - trigger: state
        entity_id: input_select.topny_rezim
        to: "Auto"
      - trigger: homeassistant
        event: start
    conditions:
      - condition: state
        entity_id: input_select.topny_rezim
        state: "Auto"
      - condition: state
        entity_id: input_boolean.topny_system_enable
        state: "on"
    actions:
      # 1) Vypnout Boost, pokud nƒõkde z≈Østal zapnut√Ω
      - choose:
          - conditions:
              - condition: state
                entity_id: input_boolean.boost_now
                state: "on"
            sequence:
              - action: input_boolean.turn_off
                target:
                  entity_id: input_boolean.boost_now

      # 2) (Voliteln√©) vynulovat boost_until ‚Äì nen√≠ nutn√©, ale a≈• je ƒçisto
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.boost_until
        data:
          datetime: "{{ now().isoformat() }}"

      # 3) Znovu aplikovat rozvrhy ve v≈°ech z√≥n√°ch
      - action: automation.trigger
        target:
          entity_id:
            - automation.sched_prizemi_michal_end
            - automation.sched_1p_jidelna_end
            - automation.sched_2p_mama_end

      # 4) Z√°znam do logbooku
      - action: logbook.log
        data:
          name: "Topen√≠ ‚Äì re≈æimy"
          message: "Auto ‚Üí zru≈°en Boost, rozvrhy znovu aplikov√°ny."
          entity_id: input_select.topny_rezim
